{"title":"Server Preparations","markdown":{"yaml":{"title":"Server Preparations","execute":{"eval":false}},"headingText":"Server Infrastructure","containsRefs":false,"markdown":"\n\n```{r}\n#| echo: false\n#| eval: false\n\nsuppressPackageStartupMessages(\n  {\n  library(DBI)\n  library(RSQLite)\n  library(digest)\n  library(shiny)\n  library(shinyjs)\n  library(DBI)\n  library(RSQLite)\n  library(digest)\n  library(DT)\n  library(shinyWidgets)\n  library(mailR)\n  library(ldapr)\n})\n```\n\n\n### Install required system dependencies\n\n```{bash}\n\nsudo apt install -y libssl-dev libxml2-dev libcurl4-openssl-dev libudunits2-dev libgdal-dev\n\n```\n\n### Changing hostname to fit the apache2 config file\n\n```{bash}\n\n# Change the hostname\nsudo hostnamectl set-hostname ngs-testing-vm.biochem.mpg.de\n\n# Verify the change\nhostnamectl status\n\n```\n\n```{bash}\nnslookup ngs-testing-vm.biochem.mpg.de\nping ngs-testing-vm.biochem.mpg.de\n```\n\n```\nServer:     127.0.0.53\nAddress:    127.0.0.53#53\n\nNon-authoritative answer:\nName:   ngs-testing-vm.biochem.mpg.de\nAddress: 10.33.0.60\n\nPING ngs-testing-vm.biochem.mpg.de (10.33.0.60) 56(84) bytes of data.\n64 bytes from ngs-testing-vm.biochem.mpg.de (10.33.0.60): icmp_seq=1 ttl=64 time=0.079 ms\n64 bytes from ngs-testing-vm.biochem.mpg.de (10.33.0.60): icmp_seq=2 ttl=64 time=0.074 ms\n```\n\n```{bash}\n\nsudo systemctl restart apache2\n\n```\n\n### Automatic start-up\n\n```{bash}\n\nsudo systemctl enable apache2\nsudo systemctl enable shiny-server\n\n```\n\n## Monitoring\n\nThe shiny app server writes log files specific with date and time in the `/var/log/shiny-server` folder.\n\n```{bash}\n\n# Monitor Shiny Server logs\nsudo tail -f /var/log/shiny-server/sequencing-app*.log\n\n# Monitor Apache logs\nsudo tail -f /var/log/apache2/sequencing-app-error.log\n\n```\n\n## Regular backups\n\nThe VM is regularly back-up every night. The SQL database backup setting are in the script, but for now commented out, as we're not in productive version.\n\n### cron job for data base backup\n\nIf needed, we can also set up a cron job to backup the data base\n\n```{bash}\n\n# Create backup script\nsudo tee /usr/local/bin/backup_sequencing_db.sh <<'EOF'\n#!/bin/bash\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR=\"/var/backups/sequencing-app\"\nmkdir -p $BACKUP_DIR\ncp /srv/shiny-server/sequencing-app/sequencing_projects.db $BACKUP_DIR/sequencing_projects.db.$TIMESTAMP\n# Keep only last 30 days of backups\nfind $BACKUP_DIR -name \"sequencing_projects.db.*\" -mtime +30 -delete\nEOF\n\nsudo chmod +x /usr/local/bin/backup_sequencing_db.sh\n\n# Add to crontab for daily backups at 2 AM\nsudo crontab -l | { cat; echo \"0 2 * * * /usr/local/bin/backup_sequencing_db.sh\"; } | sudo crontab -\n\n```\n\n## Required Server Setup\n\n```\n/srv/shiny-server/\n├── sequencing-app/\n│ ├── app.R\n│ ├── setup_database.R\n│ ├── sequencing_projects.db\n│ └── www/\n  │ ├── logo.png\n  │ └── minerva.png\n```\n\n## Github repository\n\n### Step 1: Generate SSH keys\n\n```{bash}\n\n# on the local machine (mac mini at work!!!)\ncd ~/.ssh/\nssh-keygen -t ed25519 -C \"yeroslaviz@biochem.mpg.de\" -f ngs-testing-vm.id_macMini_rsa\n\n# on the VM\ncd ~/.ssh/\nssh-keygen -t ed25519 -C \"yeroslaviz@biochem.mpg.de\" -f ngs-testing-vm.id_rsa\n```\n\nIf agent needs to be activated\n\n```{bash}\neval \"$(ssh-agent -s)\"\nssh-add ~/.ssh/ngs-testing-vm.id_rsa # or the name of the local key\n```\n\n### Add both keys to the github repository\n\nCopy for each of the two keys the `*pub` version and add it under `Settings → SSH and GPG keys → New SSH key`.\n\n### Make sure we clone using ssh (not html)\n\nFirst test if the connection exists already.\n\n```{bash}\ngit remote -v\n```\n\nIf the result is\n\n```\norigin  https://github.com/username/repository.git (fetch)\norigin  https://github.com/username/repository.git (push)\n```\n\nit must be changed to ssh\n\n```{bash}\ngit remote set-url origin git@github.com:username/repository.git\n```\n\nIf we see\n\n```\norigin  git@github.com:yeroslaviz/BCFNGS-project-management.git (fetch)\norigin  git@github.com:yeroslaviz/BCFNGS-project-management.git (push)\n```\n\nthen we already use ssh.\n\n### Test and check the connection\n\n```{bash}\nssh -T git@github.com\n```\n\nthis should return something like\n\n```\nHi yeroslaviz! You've successfully authenticated, but GitHub does not provide shell access.\n```\n\n### Pulling/Pushing\n\nthe repository can be managed from the path `/home/yeroslaviz/BCFNGS-project-management` (the VM path is mentioned here).\n\ninside the Folder we can pull/push the changes we made to the repo from the local computer (AT WORK!!!).\n\nthe github repository on the local computer is at `/Users/yeroslaviz/Documents/Github/BCFNGS-project-management`.\n\nTo redeploy the server, one follows the following steps:\n\n1.  make the changes on the local computer (AT WORK!!!).\n2.  **commit** and **push** the changes to the github repo\n3.  go to the folder `/home/yeroslaviz/BCFNGS-project-management` on the VM `ngs-testing-vm` and pull the changes.\n4.  Execute the `deploy.sh` script to copy the new changes to the shiny-server folder and restart both apache2 and the shiny-server.\n\n### Production rollout checklist (quick reference)\n\nThis is the short checklist I use on production. Details for each step are below in the VM rollout HOW‑TO section.\n\n1.  Confirm GitHub access and pull latest code.\n\n```{bash}\nssh -T git@github.com\ncd /home/yeroslaviz/BCFNGS-project-management\ngit pull origin main\n```\n\n2.  Take backups (app folder, SQLite DB, Apache config).\n\n```{bash}\nsudo rsync -av /srv/shiny-server/sequencing-app/ /srv/shiny-server/sequencing-app.backup_$(date +%Y%m%d_%H%M)/\ncp /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n  /srv/shiny-server/sequencing_projects.db.backup_$(date +%Y%m%d_%H%M)\nsudo cp /etc/apache2/sites-enabled/01-main.conf \\\n  /etc/apache2/sites-enabled/01-main.conf.backup_$(date +%Y%m%d_%H%M)\n```\n\n3.  Deploy.\n\n```{bash}\n./deploy.sh\n```\n\n4.  Restart services.\n\n```{bash}\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\n5.  Smoke‑test login and app behavior.\n\n```{bash}\ncurl -Ik https://ngs-testing-vm.biochem.mpg.de/\ncurl -Ik -u USER https://ngs-testing-vm.biochem.mpg.de/\ncurl -Ik -u USER https://ngs-testing-vm.biochem.mpg.de/sequencing-app/\n```\n\n6.  Roll back from backups if needed.\n\n```{bash}\nsudo rsync -av --delete /srv/shiny-server/sequencing-app.backup_YYYYMMDD_HHMM/ /srv/shiny-server/sequencing-app/\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\n### VM rollout HOW‑TO (Git + deploy + safety)\n\nThis is the repeatable checklist I use when rolling out to a VM (first `ngs-testing-vm`, then `ngs-vm`).\n\n#### 1) Make sure GitHub access works on the VM\n\nCheck which remote is set:\n\n```{bash}\ngit -C /home/yeroslaviz/BCFNGS-project-management remote -v\n```\n\nIf the remote is SSH (`git@github.com:...`), verify SSH access:\n\n```{bash}\nssh -T git@github.com\n```\n\nIf SSH works but `git pull` still says **Permission denied (publickey)**, the VM key is **not added** to the repo. The fix is to add the VM public key as a **Deploy Key**:\n\n```{bash}\ncat ~/.ssh/id_ed25519.pub\n```\n\nThen add that key in GitHub:\n`Repo → Settings → Deploy keys → Add deploy key` (read‑only is enough for pull).\n\n#### 2) Pull latest code\n\n```{bash}\ncd /home/yeroslaviz/BCFNGS-project-management\ngit pull origin main\n```\n\nIf Git says **divergent branches**, I set merge as the default and pull again:\n\n```{bash}\ngit config pull.rebase false\ngit pull origin main\n```\n\nIf Git refuses because of the local SQLite DB file, I stop tracking the DB on the VM:\n\n```{bash}\ngit rm --cached sequencing-app/sequencing_projects.db\ngit commit -m \"Stop tracking local SQLite DB on VM\"\ngit pull origin main\n```\n\nThis does **not** delete the local DB file. It just removes it from Git so future pulls work.\n\n#### 3) Production safety backups (fast rollback)\n\n```{bash}\nsudo rsync -av /srv/shiny-server/sequencing-app/ /srv/shiny-server/sequencing-app.backup_$(date +%Y%m%d_%H%M)/\ncp /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n  /srv/shiny-server/sequencing-app/sequencing_projects.db.backup_$(date +%Y%m%d_%H%M)\nsudo cp /etc/apache2/sites-enabled/01-main.conf \\\n  /etc/apache2/sites-enabled/01-main.conf.backup_$(date +%Y%m%d_%H%M)\n```\n\n#### 4) Deploy\n\n```{bash}\n./deploy.sh\n```\n\n#### 5) Restart and smoke‑test\n\n```{bash}\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\nThen open the app URL and verify:\n- LDAP prompt appears\n- login works\n- app loads\n\n#### 6) Rollback (if needed)\n\n```{bash}\nsudo rsync -av --delete /srv/shiny-server/sequencing-app.backup_YYYYMMDD_HHMM/ /srv/shiny-server/sequencing-app/\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\n## Security\n\nNot sure, if this is all necessary, will consult the IT when it is appropriate\n\n### Backup older settings\n\n```{bash}\n\n# Backup your current configuration\nsudo cp /etc/apache2/sites-enabled/01-main.conf /etc/apache2/sites-enabled/01-main.conf.backup\n\n# Remove old SSL certificates (optional - keep for backup)\nsudo mkdir -p /etc/ssl/backup/\nsudo mv /etc/ssl/certs/********.pem /etc/ssl/backup/\nsudo mv /etc/ssl/private/********.pem /etc/ssl/backup/\nsudo mv /etc/apache2/certificate/********.cer /etc/ssl/backup/\n\n```\n\n```\n./\n├── 01-main.conf -> ../sites-available/default-ssl.conf\n├── 01-main.conf.backup\n├── 02-testing.conf -> ../sites-available/02-testing.conf\n└── auth_ldap.conf -> ../sites-available/auth_ldap.conf\n```\n\n### Applying for a new certificate from MPI/MPG\n\nThe new setting of the certificates. I have three files.\n\nThe private key I created when applying for the certificate. The other two were downloaded, when the emial came from Harica (the certificate provider).\n\nthe `PEM` is the pem file and the `DER (issuer)` is the chain file. Both of them are needed.\n\nSetting for the readability of the files:\n\n```\ncd /etc/apache2/certificate/2026\n-rw------- 1 yeroslaviz b_mcf 3272 Nov 10 15:58 private-key.pem # udo chmod 600 /path/to/private.key  # Readable only by root\n-rw-r--r-- 1 yeroslaviz b_mcf 1545 Nov 14 12:12 NGS_2026_Issuer_ChainFile.cer # sudo chmod 644 /path/to/chain.crt  # Readable by all\n-rw-r--r-- 1 yeroslaviz b_mcf 2796 Nov 14 12:34 NGS_2026_Cert.pem # sudo chmod 644 /path/to/certificate.crt # Readable by all\n```\n\nAll the files are saved under `/etc/apache2/certificate/2026`.\n\nNow I created soft links for each of these files.\n\n```{bash}\nsudo ln -s /etc/apache2/certificate/2026/private-key.pem /etc/ssl/private/2026_private-key.pem\nsudo ln -s /etc/apache2/certificate/2026/NGS_2026_Cert.pem /etc/ssl/certs/2026_NGS_Cert.pem\n\n```\n\n### Firewall\n\nat the moment is not active, but maybe in the future.\n\n```{bash}\n\nsudo ufw allow 3838\nsudo ufw allow 80\nsudo ufw allow 443\n\n```\n\n## Change connection to shiny server folder to https\n\nThe shiny app takes information from the config file under `/etc/shiny-server/shiny-server.conf`. Here we can see where the log files are written into and where the directory of the shiny app are stored.\n\n```{bash}\nsudo usermod -a -G shiny $USER # add user yeroslaviz to group shiny\nsudo chown -R $USER:shiny sequencing-app/ # make group shiny able to execute the scripts in the folder\nsudo mv /srv/shiny-server/sequencing-app/ /srv/shiny-server/sequencing-app.backup # move the actual hard-coded folder to a backup (just in case)\n```\n\nThe sequencing-app folder must be copied to the correct place after each modification was done and the new files were pulled to the VM.\n\nFor that I have created a script called `deploy.sh`. The script synchronizes the files from the github repo folder `/home/yeroslaviz/BCFNGS-project-management/sequencing-app/` to where the Shiny app needs them to be: `/srv/shiny-server/sequencing-app/`.\n\nThe deploy script must be activated when loaded\n\n```{bash}\nchmod +x deploy.sh\n```\n\nThe deploy.sh script uses `rsync` and **excludes** `sequencing_projects.db` so the production database is not overwritten during deploys.\n\nIf `rsync` is not installed on the VM:\n\n```{bash}\nsudo apt install -y rsync\n```\n\nIt then resets permissions for all files (the DB file remains in place and keeps its permissions).\n\nWhen this is done, it restart the shiny server.\n\n**This script must be run each time the files inside the sequencing-app folder were changed**, but not if other changed were made in the repo.\n\n## Changes on 12.02.2026\n\n1.  Fixed LDAP URL impersonation risk by enforcing canonical `auth_user` handling in Apache: tampered `?auth_user=` values are rewritten to the authenticated LDAP user.\n2.  Fixed redirect-loop behavior in the Apache auth rewrite logic and validated canonical redirect behavior with `curl` (expected `302` to the authenticated user).\n3.  Confirmed and documented required shiny-server environment for LDAP mode:\n    - `AUTH_MODE=ldap`\n    - `TRUST_PROXY_AUTH_USER_QUERY=1`\n4.  Extended `deploy.sh` with post-deploy LDAP smoke tests (canonical redirect, tampered query rewrite, final `200` response) and actionable failure hints.\n5.  Added/merged troubleshooting guidance for LDAP login failures, disconnects, and redirect loops into the VM troubleshooting documentation.\n6.  Improved Projects table readability in the Shiny UI (`sequencing-app/app.R`):\n    - explicit DT column widths\n    - wrapped long cell text\n    - reliable column reflow on tab switch and resize\n    - preserved horizontal scrolling and existing formatting.\n\n## Changes on 11.02.2026\n\n1.  Added a production rollout checklist with the exact commands for pull, backup, deploy, restart, and smoke‑tests.\n2.  Added a dedicated section for **admin access in LDAP mode** (pre‑create vs promote after first login).\n3.  Added a dedicated section on **switching between LDAP and local auth** on the VM (`AUTH_MODE` via systemd override).\n4.  Added the full **pre‑create admin** example that includes `password`/`email` for NOT NULL constraints.\n5.  Updated the canonical server path to `/srv/shiny-server` and corrected repo path on the local machine.\n6.  Moved legacy/obsolete content to the end of the document under **Obsolete / now wrong**.\n7.  Replaced the old deploy script reference (`deploy_shiny_server.sh`) with `deploy.sh`.\n\n## Changes on 09.02.2026\n\n1.  Added a VM rollout HOW‑TO (GitHub SSH/deploy keys, divergent branches, DB tracking fix, backups, deploy, restart, rollback).\n2.  Documented production safeguards (app folder backup, DB backup, Apache config backup).\n3.  Updated `deploy.sh` to restart Shiny only if `rsync` succeeds (prevents restarts on failed deploys).\n4.  Cleaned up Apache LDAP logging (default to quiet logs; debug only when explicitly enabled).\n5.  Made LDAP debug output in the Shiny app conditional on **both** `APP_ENV=dev` and `LDAP_DEBUG=1` to avoid production log noise.\n6.  Documented the VM LDAP validation test (real user + service group user, and email routing behavior).\n\n### VM rollout validation (what I tested and confirmed)\n\nI verified end‑to‑end behavior on the VM after fixing the Apache proxy path:\n\n-   **LDAP login works**: the browser prompts for username/password and redirects to `/sequencing-app/?auth_user=<user>`.\n-   **User mapping works**: `yeroslaviz` (OU contains Cox) is mapped to the **Cox** group and the correct PI.\n-   **User mapping works**: `yeroslaviz-test` (OU = **NGS Facility**) is treated as a service‑group user (no PI match).\n-   **Email routing works**: research group users trigger mail to the PI **and** NGS.\n-   **Email routing works**: service group users (no PI match) trigger mail to the **administrator**.\n\nIf all three happen, the LDAP→app→email flow is working as intended.\n\n## Possible errors and fixes (VM LDAP rollout)\n\nThis section captures the real errors I hit during the VM rollout and the fixes that worked. It is meant as a troubleshooting reference.\n\n### 1) Apache won’t restart after LDAP change\n\n**Symptom**\n\n```\nAH00526: Syntax error ... Bad LDAP URL while parsing.\n```\n\n**Cause**\n\nApache’s `AuthLDAPURL` is very strict. Each URL must be complete (host + base DN + query), and some Apache builds don’t accept multiple URLs in a single directive.\n\n**Fix**\n\nUse a single server (most stable on my VM):\n\n```\nAuthLDAPURL \"ldaps://ldapserv1.biochem.mpg.de:636/dc=biochem,dc=mpg,dc=de?uid?sub?(objectClass=posixAccount)\"\n```\n\nIf the multi‑server line fails, I keep one server and fall back manually if needed.\n\n### 2) `LDAPTLS_CACERTDIR` breaks Apache\n\n**Symptom**\n\n```\nInvalid command 'LDAPTLS_CACERTDIR'\n```\n\n**Cause**\n\n`LDAPTLS_CACERTDIR` is **not** an Apache directive. It belongs to the OpenLDAP client config.\n\n**Fix**\n\nRemove it from Apache. If I need TLS trust, I configure it in `/etc/ldap/ldap.conf` instead.\n\n### 3) LDAP login shows 500 Internal Server Error\n\n**Symptom**\n\n- Browser shows `Internal Server Error`\n- Apache log shows:\n\n```\nldap_simple_bind() failed][Can't contact LDAP server]\n```\n\n**Cause**\n\nLDAP TLS handshake fails (certificate trust not configured).\n\n**Fix**\n\n1. Confirm port reachability:\n\n```\nnc -vz ldapserv1.biochem.mpg.de 636\n```\n\n2. Test LDAP with **TLS bypass** to confirm trust problem:\n\n```\nLDAPTLS_REQCERT=never ldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de:636 \\\n  -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=USER)\" mail\n```\n\n3. Fix trust in `/etc/ldap/ldap.conf`:\n\n```\nTLS_CACERTDIR /etc/ssl/certs\n```\n\n**Important:** I had a typo (`TLS_CACERETDIR`) which prevented TLS trust from loading. Fixing the spelling made LDAP work.\n\n4. Verify normal LDAP now works:\n\n```\nldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de:636 \\\n  -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=USER)\" mail\n```\n\nThen restart Apache:\n\n```\nsudo systemctl restart apache2\n```\n\n### 4) Shiny app runs locally but crashes via Apache\n\n**Symptom**\n\n- App works with `shiny::runApp()`\n- But Apache shows 500 and Shiny worker terminates\n\n**Cause**\n\nLDAP authentication failure in Apache (not an app crash).\n\n**Fix**\n\nCheck Apache log for `authnz_ldap` errors and fix TLS trust as above.\n\n### 5) LDAP works, but `/sequencing-app/` returns 404\n\n**Symptom**\n\n- `curl -Ik -u USER https://host/sequencing-app/` returns **404**\n- `curl -I http://localhost:3838/sequencing-app/` returns **200**\n\n**Cause**\n\nApache is proxying the wrong path (often due to an older `ProxyPass /` rule or a backup file in `sites-enabled`).\n\n**Fix**\n\n1.  Ensure **only** these lines exist in the active config:\n\n```\nProxyPass /sequencing-app/ http://localhost:3838/sequencing-app/\nProxyPassReverse /sequencing-app/ http://localhost:3838/sequencing-app/\n```\n\n2.  Remove or move any backup config files out of `/etc/apache2/sites-enabled` (Apache can accidentally parse them).\n3.  Restart Apache:\n\n```\nsudo apache2ctl -t\nsudo systemctl restart apache2\n```\n\n### 6) Debug logging too noisy (Apache or Shiny)\n\n**Symptom**\n\nLots of LDAP debug output in logs during normal use.\n\n**Fix (Apache)**\n\nIn `01-main.conf`, use normal logging:\n\n```\nLogLevel warn\n# LogLevel authnz_ldap:debug ldap:debug   # enable only when debugging\n```\n\n**Fix (Shiny app)**\n\nThe app only prints LDAP debug logs when **both** are set:\n\n- `APP_ENV=dev`\n- `LDAP_DEBUG=1`\n\nSo for production:\n\n- Remove `LDAP_DEBUG=1` from `/home/shiny/.Renviron` (or set it to `0`).\n- Restart Shiny:\n\n```\nsudo systemctl restart shiny-server\n```\n\nIf I need debugging later, I can temporarily set:\n\n```\nAPP_ENV=dev\nLDAP_DEBUG=1\n```\n\nand restart the service again.\n\n### Comprehensive error‑checking checklist (VM LDAP + Shiny)\n\nWhen something breaks, I run through this list in order:\n\n1.  **Apache syntax**\n\n```\nsudo apache2ctl -t\n```\n\n2.  **Which vhost is active**\n\n```\nsudo apache2ctl -S\n```\n\n3.  **Proxy path**\n\n```\nsudo grep -n \"ProxyPass\" -R /etc/apache2/sites-enabled /etc/apache2/conf-enabled\n```\n\n4.  **LDAP connectivity + TLS**\n\n```\nnc -vz ldapserv1.biochem.mpg.de 636\nldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de:636 \\\n  -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=USER)\" mail\n```\n\nIf that fails, verify `/etc/ldap/ldap.conf` has:\n\n```\nTLS_CACERTDIR /etc/ssl/certs\n```\n\n5.  **LDAP auth prompt vs app redirect**\n\n```\ncurl -Ik https://HOST/\ncurl -Ik -u USER https://HOST/\n```\n\nExpected:\n401 without user, 302 to `/sequencing-app/?auth_user=USER` with user.\n\n6.  **Shiny backend is reachable**\n\n```\ncurl -I http://localhost:3838/sequencing-app/\n```\n\n7.  **Apache app path**\n\n```\ncurl -Ik -u USER https://HOST/sequencing-app/\n```\n\n8.  **Shiny logs**\n\n```\nsudo ls -t /var/log/shiny-server/ | head -n 1\nsudo tail -n 200 /var/log/shiny-server/FILE.log\n```\n\n9.  **Shiny environment variables**\n\n```\nsudo systemctl show shiny-server --property=Environment\n```\n\n10. **Database permissions**\n\n```\nls -l /srv/shiny-server/sequencing-app/sequencing_projects.db\n```\n\n11. **Reload after config change**\n\n```\nsudo systemctl restart apache2\nsudo systemctl restart shiny-server\n```\n\n## Changes on 06.02.2026\n\n1.  Added LDAP login flow in the Shiny app (auto‑login via `X-Remote-User`, local dev simulation, and optional attribute lookup).\n2.  LDAP attribute lookup now works with anonymous bind; uses `ldapsearch` fallback for older `ldapr` versions.\n3.  Added dev tools toggle (dev only) to switch between LDAP and local auth while testing.\n4.  Mapped LDAP `ou` values to budget holders, auto‑selecting the correct PI in the project form (with partial match fallback).\n5.  Added budget holder notices for multiple cost centers and missing cost center values.\n6.  Added “Other / not listed” budget holder option so users can enter a new PI (name/surname required; cost center optional with a warning).\n7.  Updated `deploy.sh` to use `rsync` and exclude `sequencing_projects.db`.\n8.  Updated Apache LDAP configuration template and added local dev testing instructions + env var cleanup.\n9.  I do **not** track SQLite DB files in git because they change constantly, are environment‑specific (local vs VM), and can contain sensitive data. I ignore `*.db`/`*.sqlite` and keep only the schema/seed files in git.\n\n## Changes on 14.11.2026\n\n1.  I would Like you to show me where the admin email address can be changed, if I want to have a different user as admin. 1.1 Please show me the parts of the script where this can be changed.\n\nThe admin password is set here:\n\n```{bash}\n# Insert default admin user\ndefault_password <- digest::digest(\"admin123\")\ndbExecute(con, \"\n  INSERT OR IGNORE INTO users (username, password, email, is_admin)\n  VALUES ('admin', ?, 'yeroslaviz@biochem.mpg.de', 1)\n\", params = list(default_password))\n```\n\n1.2 Can this be changed without recreating the whole databank or restart the app? 1.3 How do I change the admin email address without recreating the db?\n\nThis can be changed without recreating the database, using two options:\n\n-   Option 1: Direct database update\n\nRun this SQL command on your database:\n\n```{sql}\n\nUPDATE users SET email = 'newadmin@institute.org' WHERE username = 'admin';\n\n```\n\nTo execute this, we can either log in directly to the database via the command line\n\n```{bash}\nsqlite3 sequencing_projects.db\n```\n\nand execute\n\n```{bash}\nUPDATE users SET email = 'newadmin@institute.org' WHERE username = 'admin';\n.exit\n```\n\nor via the R pormpt:\n\n```{r}\nlibrary(DBI)\nlibrary(RSQLite)\ncon <- dbConnect(RSQLite::SQLite(), \"sequencing_projects.db\")\ndbExecute(con, \"UPDATE users SET email = 'newadmin@institute.org' WHERE username = 'admin'\")\ndbDisconnect(con)\n```\n\n**Don't forget to modify the `setup_database_*.R` script afterwards, so these information will be also kept, if the database is recreated!**\n\n-   Option 2: Through the app's user management (as admin)\n\nIn the \"Administer Projects\" tab, one can click \"Manage Users\" and change (or add) the admin user and edit their email.\n\n1.4 How can I turn on/off sending the notification mail to the admin, if not needed?\n\nThe admin notification email is sent in the `send_project_creation_email` function in the app file.\n\n2.  When creating a new project, an email is being sent. 2.1 can you please tell me to whome this email is being sent? 2.2 Can you show me the part of the script where it is set up? 2.3 Now, the Email should be sent to budget holder and to user, who created the project, as well as to the admin. Can this be changed easily, if needed?\n\nThis was done also in point 1. The function `send_project_creation_email` set the users who gets an email, when a project is created. the row\n\n```\n        to = c(budget_holder$email, user_email, admin_emails),\n```\n\nset the recipient of the mail. we can remove one of the elements, or even just add a specific mail address to the `to =` row.\n\n3.  How do I make changes to the cost estimations w.o. Recreating the db? 3.1 Is it possible to modify existing columns, in case prices are changing? Or would deleting and making a new element would be easier? 3.2 If I change anything in these tables, Would it also change it in the SQL data base?\n\nAt the moment the tables `Service types` and `Sequencing depths` are not editable. If prices change, the easiet option is to delete the row and recreate it using the new value. This way, the older projects will use the previous costs, while the new one will get the new costs.\n\nOne can also directly use the SQL commands to apply these chages, similar to above\n\n```{bash}\nsqlite3 sequencing_projects.db\n```\n\nand execute\n\n```{bash}\nUPDATE service_types SET costs_per_sample = 55 WHERE service_type = 'single cell/low mRNAseq';\n.exit\n```\n\n4.  something is wrong with the Sequencing Cycles Management table. When I run the app, go to the Admin projects Tab and click the Sequencing Cycles - Manage Cycles, I see this message: \"Error: An error has occurred. Check your logs or contact the app author for clarification.\" 4.1 which log files can I consult?\n\nWhen working on the server, the best place to look for problems are the log files of either the `apache2` (`/var/log/apache2/`) or the `shiny-server` (`/var/log/shiny-server/`).\n\n5.  Do I have a weekly backup of the SQL db? \n\nthere is an app for a bi-weekly automaic backup. The function is for now commented out, so not working.\n\n### modify registration page\n\n```{bash}\nsqlite3 sequencing_projects.db\n```\n\nwe add information to the registration page, so the user must choose a group. This way we know which is the budget holder for this user.\n\nAfter ward we added the information to the Registration Server Logic\n\n```{bash}\ndbExecute(con, \"\nINSERT INTO users (username, password, email, phone, research_group, is_admin)\nVALUES (?, ?, ?, ?, ?, 0)\n\", params = list(\n  input$reg_username,\n  digest(input$reg_password),\n  input$reg_email,\n  input$reg_phone,\n  input$reg_group\n))\n```\n\nas well as modified the User registration modal\n\nNow, when a user register, he must choose a group from the given drop-down menu. this group is attached to the budget holder. When the user creates a new project, this budget holder (group) will automatically be assigned to the project (This can be manually changed, when the project is created).\n\nI have changed the `setup_databases.R` script to load the budget holders information from a csv file, stored in the same folder as the script itself.\n\nWe have a csv-formatted table with the information of the groups and their cost centers. This is an easy way to upload the information.\n\n```\nname,surname,email,cost_center\nKim,Rin-Ho,rkim@biochem.mpg.de,N.A.\nAdministrator,surname,rkim@biochem.mpg.de,N.A.\nBaier,Herwig,herwig.baier@bi.mpg.de,P350\nBaldwin,Maude,Maude.Baldwin@bi.mpg.de,P550\n```\n\nThe registration process was change to make choosing a research group mandatory. The chosen research group is then set to also assign the cost center to the user.\n\n::: callout-note\nSome of the research groups have multiple cost centers.\n\nWhen a user registers, he must select a research group. The user then gets assigned a cost center based on the table of budget holders. If (and this applies only for some of the budget holders), this specific research group has multiple cost centers, it gets assigned the first one found by the app. BUT, manually the user still can change this in the app when applying for a project.\n:::\n\n### control for budegt holder info in the DB\n\n```{r}\n#| eval: false\ncon <- dbConnect(RSQLite::SQLite(), \"sequencing_projects.db\")\nbudget_holders <- dbGetQuery(con, \"SELECT * FROM budget_holders\")\n# Print the data\nprint(budget_holders[1:3,])\ndbGetQuery(con, \"SELECT * FROM budget_holders\")\ndbGetQuery(con, \"SELECT * FROM users\")\non.exit(dbDisconnect(con))\n```\n\n### Budget holders can be read from an Excel sheet\n\n## SSL Certificate (for HTTPS)\n\nthe new setting of the certificates. I have three files.\n\nThe private key I created when applying for the certificate. The other two were downloaded, when the emial came from Harica (the certificate provider).\n\nthe `PEM` is the pem file and the `DER (issuer)` is the chain file. Both of them are needed.\n\nSetting for the readability of the files:\n\n```\ncd /etc/apache2/certificate/2026\n-rw------- 1 yeroslaviz b_mcf 3272 Nov 10 15:58 private-key.pem # udo chmod 600 /path/to/private.key  # Readable only by root\n-rw-r--r-- 1 yeroslaviz b_mcf 1545 Nov 14 12:12 NGS_2026_Issuer_ChainFile.cer # sudo chmod 644 /path/to/chain.crt  # Readable by all\n-rw-r--r-- 1 yeroslaviz b_mcf 2796 Nov 14 12:34 NGS_2026_Cert.pem # sudo chmod 644 /path/to/certificate.crt # Readable by all\n```\n\nAll the files are saved under `/etc/apache2/certificate/2026`.\n\nNow I created soft links for each of these files.\n\n```{bash}\nsudo ln -s /etc/apache2/certificate/2026/private-key.pem /etc/ssl/private/2026_private-key.pem\nsudo ln -s /etc/apache2/certificate/2026/NGS_2026_Cert.pem /etc/ssl/certs/2026_NGS_Cert.pem\n\n```\n\n## LDAP\n\nThe app uses Apache LDAP authentication in front of Shiny. The Apache config template is in `01-main.conf`.\n\nEnable required Apache modules:\n\n```{bash}\nsudo a2enmod ldap authnz_ldap headers\nsudo systemctl reload apache2\n```\n\nTest whether anonymous LDAP search works:\n\n```{bash}\nldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=YOURUSER)\"\n```\n\nIf anonymous search fails, use bind credentials from IT and add them to the Apache config:\n\n``` apache\nAuthLDAPBindDN \"cn=binduser,dc=biochem,dc=mpg,dc=de\"\nAuthLDAPBindPassword \"REDACTED\"\n```\n\n::: callout-warning\nFor production, **do not use a personal account** for LDAP binding. Ask IT for a dedicated **service bind account** with read‑only permissions and store those credentials securely.\n:::\n\nSet app environment variables for Shiny Server (systemd override recommended):\n\n```{bash}\nsudo systemctl edit shiny-server\n```\n\n``` ini\n[Service]\nEnvironment=AUTH_MODE=ldap\nEnvironment=LDAP_URI=ldaps://ldapserv1.biochem.mpg.de:636,ldaps://ldapserv2.biochem.mpg.de:636,ldaps://ldapserv3.biochem.mpg.de:636\nEnvironment=LDAP_BASE_DN=dc=biochem,dc=mpg,dc=de\n# If you want to restrict search to the user OU:\n# Environment=LDAP_BASE_DN=ou=People,dc=biochem,dc=mpg,dc=de\n# Optional bind credentials (only if anonymous LDAP search is blocked):\n# Environment=LDAP_BIND_DN=cn=binduser,dc=biochem,dc=mpg,dc=de\n# Environment=LDAP_BIND_PW=REDACTED\n```\n\nRestart services after config changes:\n\n```{bash}\nsudo systemctl restart apache2\nsudo systemctl restart shiny-server\n```\n\n### Admin access in LDAP mode (VM)\n\nWhen `AUTH_MODE=ldap` is enabled, the local login form is disabled. To get admin access, I mark the **LDAP user** as admin in the SQLite database.\n\n**Option 1: Pre‑create the user as admin (works even before first login)**\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"INSERT OR IGNORE INTO users (username, is_admin) VALUES ('soyer', 1);\"\n```\n\nIf the insert is ignored because the table requires `password`/`email`, use:\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"INSERT OR IGNORE INTO users (username, password, email, is_admin) VALUES ('soyer', 'ldap-only', 'soyer@biochem.mpg.de', 1);\"\n```\n\nOn first LDAP login, the app fills in email/phone/OU (if missing).\n\n**Option 2: Promote after the user logs in once**\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"UPDATE users SET is_admin=1 WHERE username='soyer';\"\n```\n\nNote: `UPDATE` does nothing if the user row does **not** exist yet.\n\n**Verify:**\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"SELECT username, is_admin FROM users WHERE username IN ('yeroslaviz','soyer');\"\n```\n\n### Switch between LDAP and local modes (VM)\n\nI switch auth modes by changing the `AUTH_MODE` environment variable for the `shiny-server` service and restarting it.\n\nOpen the systemd override:\n\n```{bash}\nsudo systemctl edit shiny-server\n```\n\n**LDAP mode (production):**\n\n```ini\n[Service]\nEnvironment=AUTH_MODE=ldap\nEnvironment=LDAP_URI=ldaps://ldapserv1.biochem.mpg.de:636,ldaps://ldapserv2.biochem.mpg.de:636,ldaps://ldapserv3.biochem.mpg.de:636\nEnvironment=LDAP_BASE_DN=dc=biochem,dc=mpg,dc=de\n```\n\n**Local mode (maintenance/testing):**\n\n```ini\n[Service]\nEnvironment=AUTH_MODE=local\n```\n\nApply changes:\n\n```{bash}\nsudo systemctl restart shiny-server\nsudo systemctl show shiny-server --property=Environment\n```\n\nIf I switch back to LDAP, I also remove any dev‑only variables like `DEV_REMOTE_USER`.\n\n### Local dev testing (LDAP mode)\n\nTo test LDAP integration on your local machine without affecting production, run the app in dev mode and simulate the authenticated user. If LDAP attribute lookup is needed, provide a bind DN/password (personal credentials are OK for **local testing only**).\n\n``` r\nSys.setenv(\n  APP_ENV = \"dev\",\n  AUTH_MODE = \"ldap\",\n  DEV_REMOTE_USER = \"your_username\",\n  LDAP_BIND_DN = \"uid=your_username,ou=YourGroup,ou=Research Group,ou=People,dc=biochem,dc=mpg,dc=de\",\n  LDAP_BIND_PW = \"YOUR_PASSWORD\"\n)\nshiny::runApp(\"sequencing-app\")\n```\n\nAfter login, verify the user record in SQLite:\n\n``` r\ncon <- DBI::dbConnect(RSQLite::SQLite(), \"sequencing-app/sequencing_projects.db\")\nDBI::dbGetQuery(con, \"SELECT username, email, phone, research_group FROM users WHERE username='your_username'\")\nDBI::dbDisconnect(con)\n```\n\nTo switch back to normal local login (no LDAP), run:\n\n``` r\nSys.setenv(APP_ENV = \"dev\", AUTH_MODE = \"local\")\nshiny::runApp(\"sequencing-app\")\n```\n\nTo fully clear the LDAP/testing variables in your R session:\n\n``` r\nSys.unsetenv(c(\n  \"APP_ENV\", \"AUTH_MODE\", \"DEV_REMOTE_USER\",\n  \"LDAP_BIND_DN\", \"LDAP_BIND_PW\",\n  \"LDAP_URI\", \"LDAP_BASE_DN\", \"LDAP_DEBUG\"\n))\n```\n\n### How I run the app locally (my notes)\n\nWhen I want the **normal local login**, I run:\n\n```r\nSys.setenv(APP_ENV = \"dev\", AUTH_MODE = \"local\")\nshiny::runApp(\"sequencing-app\")\n```\n\nWhen I want to **simulate production LDAP login**, I run:\n\n```r\nSys.setenv(\n  APP_ENV = \"dev\",\n  AUTH_MODE = \"ldap\",\n  DEV_REMOTE_USER = \"my_username\",\n  LDAP_URI = \"ldaps://ldapserv1.biochem.mpg.de:636,ldaps://ldapserv2.biochem.mpg.de:636,ldaps://ldapserv3.biochem.mpg.de:636\",\n  LDAP_BASE_DN = \"dc=biochem,dc=mpg,dc=de\"\n)\nshiny::runApp(\"sequencing-app\")\n```\n\nIf I want to fully reset the session, I clear the env vars:\n\n```r\nSys.unsetenv(c(\n  \"APP_ENV\", \"AUTH_MODE\", \"DEV_REMOTE_USER\",\n  \"LDAP_BIND_DN\", \"LDAP_BIND_PW\",\n  \"LDAP_URI\", \"LDAP_BASE_DN\", \"LDAP_DEBUG\"\n))\n```\n\n**Local vs LDAP mode (practical difference for me):**\n\n- Local mode uses the SQLite users/passwords and shows the normal login screen.\n- LDAP mode auto‑logs in with the LDAP user, pulls email/phone/OU, and hides the local login UI.\n- LDAP mode needs network access to the institute LDAP servers.\n\n**Dev badge:**\nIn dev mode, I see a small badge in the app header that shows `DEV · LDAP` or `DEV · LOCAL`, so I always know which mode I’m running.\n\n### Budget holder auto-assignment (first login)\n\nOn first LDAP login, the app attempts to map the user to a budget holder based on the LDAP `ou` value.\\\nIf the `ou` contains a group key in parentheses (e.g., `(... Cox)`), the app matches that key against `budget_holders` and stores the **full PI name** (e.g., `Cox Juergen`) in `users.research_group`.\n\nWhen a new project is created, this `research_group` value is used to auto‑select the budget holder (and thus the cost center).\\\nIf multiple cost centers exist for the same PI, the first match is selected by default and can be adjusted during project creation.\n\n## Obsolete / now wrong (kept for reference)\n\nThese sections are retained to understand the history but should not be followed anymore.\n\n### Legacy environment variable location (no longer used)\n\n```{bash}\n\n# /var/shiny-server/.Renviron\nTZ=Europe/Berlin\nLANG=en_US.UTF-8\nLC_ALL=en_US.UTF-8\n\n```\n\n### Legacy folder layout (/var/shiny-server)\n\n```\n/var/shiny-server/\n├── sequencing-app/\n│ ├── app.R\n│ ├── setup_database.R\n│ ├── sequencing_projects.db\n│ └── www/\n  │ ├── logo.png\n  │ └── minerva.png\n```\n\n### Legacy install steps (nginx-based, superseded by Apache setup)\n\n```{bash}\n\n# Install Shiny Server on Ubuntu\nsudo apt update\nsudo apt install -y r-base nginx\nsudo apt install -y libfontconfig1-dev libfreetype6-dev libpng-dev libtiff5-dev \\\n    libjpeg-dev build-essential pkg-config libharfbuzz-dev libfribidi-dev\nsudo apt install -y libldap2-dev libsasl2-dev\n\nsudo su - -c \"R -e \\\"install.packages('shiny')\\\"\"\nsudo su - -c \"R -e \\\"install.packages('shinyjs')\\\"\"\n# ... install all your R packages\nsudo R -e \"install.packages(c('shiny', 'shinyjs', 'DBI', 'RSQLite', 'digest', 'DT', 'shinyWidgets', 'mailR'))\"\n# these two packages were added later on for the connection of the app to the LDAP server\nsudo R -e \"install.packages(c('devtools'))\"\nsudo R -e \"devtools::install_github('liamgilbey/ldapr')\"\n\n# Download and install Shiny Server\nwget https://download3.rstudio.org/ubuntu-20.04/x86_64/shiny-server-1.5.23.1030-amd64.deb\nsudo gdebi shiny-server-1.5.23.1030-amd64.deb\n\n```\n\n### Legacy Apache config (old ProxyPass / path)\n\n```{bash}\n<VirtualHost *:80>\n    ServerName ngs-testing-vm\n    ServerAlias ngs-testing-vm.biochem.mpg.de\n    # Redirect all HTTP traffic to HTTPS\n    Redirect permanent / https://ngs-testing-vm/\n</VirtualHost>\n\n<VirtualHost *:443>\n    ServerName ngs-testing-vm\n    ServerAlias ngs-testing-vm.biochem.mpg.de\n\n    # SSL Configuration\n    SSLEngine on\n    SSLCertificateFile /etc/ssl/certs/2026_NGS_Cert.pem\n    SSLCertificateKeyFile /etc/ssl/private/2026_private-key.pem\n    SSLCertificateChainFile /etc/apache2/certificate/2026/NGS_2026_Issuer_ChainFile.cer\n\n    # Modern SSL configuration\n    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1\n    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\n    SSLHonorCipherOrder off\n\n    # Reverse proxy for Shiny app\n    ProxyPreserveHost On\n    ProxyRequests Off\n    ProxyPass / http://localhost:3838/sequencing-app/\n    ProxyPassReverse / http://localhost:3838/sequencing-app/\n\n    # WebSocket support\n    RewriteEngine on\n    RewriteCond %{HTTP:Upgrade} websocket [NC]\n    RewriteCond %{HTTP:Connection} upgrade [NC]\n    RewriteRule ^/(.*) \"ws://localhost:3838/sequencing-app/$1\" [P,L]\n\n    # Security headers\n    Header always set Strict-Transport-Security \"max-age=63072000; includeSubDomains\"\n    Header always set X-Content-Type-Options nosniff\n    Header always set X-Frame-Options SAMEORIGIN\n    Header always set Referrer-Policy \"strict-origin-when-cross-origin\"\n\n    ErrorLog ${APACHE_LOG_DIR}/sequencing-app-ssl-error.log\n    CustomLog ${APACHE_LOG_DIR}/sequencing-app-ssl-access.log combined\n</VirtualHost>\n```\n\n### Legacy deployment script name\n\nThe old notes referenced `deploy_shiny_server.sh`. This has been replaced by `deploy.sh` in the repo root.\n\n### Legacy tree output (old VM layout example)\n\n```\n$ tree -L 1\n.\n├── BCFNGS-project-management\n├── chemata\n├── miniconda3\n└── scripts\n    └── deploy_shiny_server.sh\n```\n\n### Legacy git pull via HTTPS + PAT (no longer used)\n\n```{bash}\n git pull origin main\n# Username for 'https://github.com': yeroslaviz\n# Password for 'https://yeroslaviz@github.com':  HERE WE MUST INPUT THE PAT from above!!!\n ...\n```\n\n### Legacy note: dedicated user (superseded)\n\nAs we're planning to use the LDAP, I'm not sure, this is necessary. I need a method to add specific users as admin.\n","srcMarkdownNoYaml":"\n\n```{r}\n#| echo: false\n#| eval: false\n\nsuppressPackageStartupMessages(\n  {\n  library(DBI)\n  library(RSQLite)\n  library(digest)\n  library(shiny)\n  library(shinyjs)\n  library(DBI)\n  library(RSQLite)\n  library(digest)\n  library(DT)\n  library(shinyWidgets)\n  library(mailR)\n  library(ldapr)\n})\n```\n\n## Server Infrastructure\n\n### Install required system dependencies\n\n```{bash}\n\nsudo apt install -y libssl-dev libxml2-dev libcurl4-openssl-dev libudunits2-dev libgdal-dev\n\n```\n\n### Changing hostname to fit the apache2 config file\n\n```{bash}\n\n# Change the hostname\nsudo hostnamectl set-hostname ngs-testing-vm.biochem.mpg.de\n\n# Verify the change\nhostnamectl status\n\n```\n\n```{bash}\nnslookup ngs-testing-vm.biochem.mpg.de\nping ngs-testing-vm.biochem.mpg.de\n```\n\n```\nServer:     127.0.0.53\nAddress:    127.0.0.53#53\n\nNon-authoritative answer:\nName:   ngs-testing-vm.biochem.mpg.de\nAddress: 10.33.0.60\n\nPING ngs-testing-vm.biochem.mpg.de (10.33.0.60) 56(84) bytes of data.\n64 bytes from ngs-testing-vm.biochem.mpg.de (10.33.0.60): icmp_seq=1 ttl=64 time=0.079 ms\n64 bytes from ngs-testing-vm.biochem.mpg.de (10.33.0.60): icmp_seq=2 ttl=64 time=0.074 ms\n```\n\n```{bash}\n\nsudo systemctl restart apache2\n\n```\n\n### Automatic start-up\n\n```{bash}\n\nsudo systemctl enable apache2\nsudo systemctl enable shiny-server\n\n```\n\n## Monitoring\n\nThe shiny app server writes log files specific with date and time in the `/var/log/shiny-server` folder.\n\n```{bash}\n\n# Monitor Shiny Server logs\nsudo tail -f /var/log/shiny-server/sequencing-app*.log\n\n# Monitor Apache logs\nsudo tail -f /var/log/apache2/sequencing-app-error.log\n\n```\n\n## Regular backups\n\nThe VM is regularly back-up every night. The SQL database backup setting are in the script, but for now commented out, as we're not in productive version.\n\n### cron job for data base backup\n\nIf needed, we can also set up a cron job to backup the data base\n\n```{bash}\n\n# Create backup script\nsudo tee /usr/local/bin/backup_sequencing_db.sh <<'EOF'\n#!/bin/bash\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR=\"/var/backups/sequencing-app\"\nmkdir -p $BACKUP_DIR\ncp /srv/shiny-server/sequencing-app/sequencing_projects.db $BACKUP_DIR/sequencing_projects.db.$TIMESTAMP\n# Keep only last 30 days of backups\nfind $BACKUP_DIR -name \"sequencing_projects.db.*\" -mtime +30 -delete\nEOF\n\nsudo chmod +x /usr/local/bin/backup_sequencing_db.sh\n\n# Add to crontab for daily backups at 2 AM\nsudo crontab -l | { cat; echo \"0 2 * * * /usr/local/bin/backup_sequencing_db.sh\"; } | sudo crontab -\n\n```\n\n## Required Server Setup\n\n```\n/srv/shiny-server/\n├── sequencing-app/\n│ ├── app.R\n│ ├── setup_database.R\n│ ├── sequencing_projects.db\n│ └── www/\n  │ ├── logo.png\n  │ └── minerva.png\n```\n\n## Github repository\n\n### Step 1: Generate SSH keys\n\n```{bash}\n\n# on the local machine (mac mini at work!!!)\ncd ~/.ssh/\nssh-keygen -t ed25519 -C \"yeroslaviz@biochem.mpg.de\" -f ngs-testing-vm.id_macMini_rsa\n\n# on the VM\ncd ~/.ssh/\nssh-keygen -t ed25519 -C \"yeroslaviz@biochem.mpg.de\" -f ngs-testing-vm.id_rsa\n```\n\nIf agent needs to be activated\n\n```{bash}\neval \"$(ssh-agent -s)\"\nssh-add ~/.ssh/ngs-testing-vm.id_rsa # or the name of the local key\n```\n\n### Add both keys to the github repository\n\nCopy for each of the two keys the `*pub` version and add it under `Settings → SSH and GPG keys → New SSH key`.\n\n### Make sure we clone using ssh (not html)\n\nFirst test if the connection exists already.\n\n```{bash}\ngit remote -v\n```\n\nIf the result is\n\n```\norigin  https://github.com/username/repository.git (fetch)\norigin  https://github.com/username/repository.git (push)\n```\n\nit must be changed to ssh\n\n```{bash}\ngit remote set-url origin git@github.com:username/repository.git\n```\n\nIf we see\n\n```\norigin  git@github.com:yeroslaviz/BCFNGS-project-management.git (fetch)\norigin  git@github.com:yeroslaviz/BCFNGS-project-management.git (push)\n```\n\nthen we already use ssh.\n\n### Test and check the connection\n\n```{bash}\nssh -T git@github.com\n```\n\nthis should return something like\n\n```\nHi yeroslaviz! You've successfully authenticated, but GitHub does not provide shell access.\n```\n\n### Pulling/Pushing\n\nthe repository can be managed from the path `/home/yeroslaviz/BCFNGS-project-management` (the VM path is mentioned here).\n\ninside the Folder we can pull/push the changes we made to the repo from the local computer (AT WORK!!!).\n\nthe github repository on the local computer is at `/Users/yeroslaviz/Documents/Github/BCFNGS-project-management`.\n\nTo redeploy the server, one follows the following steps:\n\n1.  make the changes on the local computer (AT WORK!!!).\n2.  **commit** and **push** the changes to the github repo\n3.  go to the folder `/home/yeroslaviz/BCFNGS-project-management` on the VM `ngs-testing-vm` and pull the changes.\n4.  Execute the `deploy.sh` script to copy the new changes to the shiny-server folder and restart both apache2 and the shiny-server.\n\n### Production rollout checklist (quick reference)\n\nThis is the short checklist I use on production. Details for each step are below in the VM rollout HOW‑TO section.\n\n1.  Confirm GitHub access and pull latest code.\n\n```{bash}\nssh -T git@github.com\ncd /home/yeroslaviz/BCFNGS-project-management\ngit pull origin main\n```\n\n2.  Take backups (app folder, SQLite DB, Apache config).\n\n```{bash}\nsudo rsync -av /srv/shiny-server/sequencing-app/ /srv/shiny-server/sequencing-app.backup_$(date +%Y%m%d_%H%M)/\ncp /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n  /srv/shiny-server/sequencing_projects.db.backup_$(date +%Y%m%d_%H%M)\nsudo cp /etc/apache2/sites-enabled/01-main.conf \\\n  /etc/apache2/sites-enabled/01-main.conf.backup_$(date +%Y%m%d_%H%M)\n```\n\n3.  Deploy.\n\n```{bash}\n./deploy.sh\n```\n\n4.  Restart services.\n\n```{bash}\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\n5.  Smoke‑test login and app behavior.\n\n```{bash}\ncurl -Ik https://ngs-testing-vm.biochem.mpg.de/\ncurl -Ik -u USER https://ngs-testing-vm.biochem.mpg.de/\ncurl -Ik -u USER https://ngs-testing-vm.biochem.mpg.de/sequencing-app/\n```\n\n6.  Roll back from backups if needed.\n\n```{bash}\nsudo rsync -av --delete /srv/shiny-server/sequencing-app.backup_YYYYMMDD_HHMM/ /srv/shiny-server/sequencing-app/\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\n### VM rollout HOW‑TO (Git + deploy + safety)\n\nThis is the repeatable checklist I use when rolling out to a VM (first `ngs-testing-vm`, then `ngs-vm`).\n\n#### 1) Make sure GitHub access works on the VM\n\nCheck which remote is set:\n\n```{bash}\ngit -C /home/yeroslaviz/BCFNGS-project-management remote -v\n```\n\nIf the remote is SSH (`git@github.com:...`), verify SSH access:\n\n```{bash}\nssh -T git@github.com\n```\n\nIf SSH works but `git pull` still says **Permission denied (publickey)**, the VM key is **not added** to the repo. The fix is to add the VM public key as a **Deploy Key**:\n\n```{bash}\ncat ~/.ssh/id_ed25519.pub\n```\n\nThen add that key in GitHub:\n`Repo → Settings → Deploy keys → Add deploy key` (read‑only is enough for pull).\n\n#### 2) Pull latest code\n\n```{bash}\ncd /home/yeroslaviz/BCFNGS-project-management\ngit pull origin main\n```\n\nIf Git says **divergent branches**, I set merge as the default and pull again:\n\n```{bash}\ngit config pull.rebase false\ngit pull origin main\n```\n\nIf Git refuses because of the local SQLite DB file, I stop tracking the DB on the VM:\n\n```{bash}\ngit rm --cached sequencing-app/sequencing_projects.db\ngit commit -m \"Stop tracking local SQLite DB on VM\"\ngit pull origin main\n```\n\nThis does **not** delete the local DB file. It just removes it from Git so future pulls work.\n\n#### 3) Production safety backups (fast rollback)\n\n```{bash}\nsudo rsync -av /srv/shiny-server/sequencing-app/ /srv/shiny-server/sequencing-app.backup_$(date +%Y%m%d_%H%M)/\ncp /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n  /srv/shiny-server/sequencing-app/sequencing_projects.db.backup_$(date +%Y%m%d_%H%M)\nsudo cp /etc/apache2/sites-enabled/01-main.conf \\\n  /etc/apache2/sites-enabled/01-main.conf.backup_$(date +%Y%m%d_%H%M)\n```\n\n#### 4) Deploy\n\n```{bash}\n./deploy.sh\n```\n\n#### 5) Restart and smoke‑test\n\n```{bash}\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\nThen open the app URL and verify:\n- LDAP prompt appears\n- login works\n- app loads\n\n#### 6) Rollback (if needed)\n\n```{bash}\nsudo rsync -av --delete /srv/shiny-server/sequencing-app.backup_YYYYMMDD_HHMM/ /srv/shiny-server/sequencing-app/\nsudo systemctl restart shiny-server\nsudo systemctl restart apache2\n```\n\n## Security\n\nNot sure, if this is all necessary, will consult the IT when it is appropriate\n\n### Backup older settings\n\n```{bash}\n\n# Backup your current configuration\nsudo cp /etc/apache2/sites-enabled/01-main.conf /etc/apache2/sites-enabled/01-main.conf.backup\n\n# Remove old SSL certificates (optional - keep for backup)\nsudo mkdir -p /etc/ssl/backup/\nsudo mv /etc/ssl/certs/********.pem /etc/ssl/backup/\nsudo mv /etc/ssl/private/********.pem /etc/ssl/backup/\nsudo mv /etc/apache2/certificate/********.cer /etc/ssl/backup/\n\n```\n\n```\n./\n├── 01-main.conf -> ../sites-available/default-ssl.conf\n├── 01-main.conf.backup\n├── 02-testing.conf -> ../sites-available/02-testing.conf\n└── auth_ldap.conf -> ../sites-available/auth_ldap.conf\n```\n\n### Applying for a new certificate from MPI/MPG\n\nThe new setting of the certificates. I have three files.\n\nThe private key I created when applying for the certificate. The other two were downloaded, when the emial came from Harica (the certificate provider).\n\nthe `PEM` is the pem file and the `DER (issuer)` is the chain file. Both of them are needed.\n\nSetting for the readability of the files:\n\n```\ncd /etc/apache2/certificate/2026\n-rw------- 1 yeroslaviz b_mcf 3272 Nov 10 15:58 private-key.pem # udo chmod 600 /path/to/private.key  # Readable only by root\n-rw-r--r-- 1 yeroslaviz b_mcf 1545 Nov 14 12:12 NGS_2026_Issuer_ChainFile.cer # sudo chmod 644 /path/to/chain.crt  # Readable by all\n-rw-r--r-- 1 yeroslaviz b_mcf 2796 Nov 14 12:34 NGS_2026_Cert.pem # sudo chmod 644 /path/to/certificate.crt # Readable by all\n```\n\nAll the files are saved under `/etc/apache2/certificate/2026`.\n\nNow I created soft links for each of these files.\n\n```{bash}\nsudo ln -s /etc/apache2/certificate/2026/private-key.pem /etc/ssl/private/2026_private-key.pem\nsudo ln -s /etc/apache2/certificate/2026/NGS_2026_Cert.pem /etc/ssl/certs/2026_NGS_Cert.pem\n\n```\n\n### Firewall\n\nat the moment is not active, but maybe in the future.\n\n```{bash}\n\nsudo ufw allow 3838\nsudo ufw allow 80\nsudo ufw allow 443\n\n```\n\n## Change connection to shiny server folder to https\n\nThe shiny app takes information from the config file under `/etc/shiny-server/shiny-server.conf`. Here we can see where the log files are written into and where the directory of the shiny app are stored.\n\n```{bash}\nsudo usermod -a -G shiny $USER # add user yeroslaviz to group shiny\nsudo chown -R $USER:shiny sequencing-app/ # make group shiny able to execute the scripts in the folder\nsudo mv /srv/shiny-server/sequencing-app/ /srv/shiny-server/sequencing-app.backup # move the actual hard-coded folder to a backup (just in case)\n```\n\nThe sequencing-app folder must be copied to the correct place after each modification was done and the new files were pulled to the VM.\n\nFor that I have created a script called `deploy.sh`. The script synchronizes the files from the github repo folder `/home/yeroslaviz/BCFNGS-project-management/sequencing-app/` to where the Shiny app needs them to be: `/srv/shiny-server/sequencing-app/`.\n\nThe deploy script must be activated when loaded\n\n```{bash}\nchmod +x deploy.sh\n```\n\nThe deploy.sh script uses `rsync` and **excludes** `sequencing_projects.db` so the production database is not overwritten during deploys.\n\nIf `rsync` is not installed on the VM:\n\n```{bash}\nsudo apt install -y rsync\n```\n\nIt then resets permissions for all files (the DB file remains in place and keeps its permissions).\n\nWhen this is done, it restart the shiny server.\n\n**This script must be run each time the files inside the sequencing-app folder were changed**, but not if other changed were made in the repo.\n\n## Changes on 12.02.2026\n\n1.  Fixed LDAP URL impersonation risk by enforcing canonical `auth_user` handling in Apache: tampered `?auth_user=` values are rewritten to the authenticated LDAP user.\n2.  Fixed redirect-loop behavior in the Apache auth rewrite logic and validated canonical redirect behavior with `curl` (expected `302` to the authenticated user).\n3.  Confirmed and documented required shiny-server environment for LDAP mode:\n    - `AUTH_MODE=ldap`\n    - `TRUST_PROXY_AUTH_USER_QUERY=1`\n4.  Extended `deploy.sh` with post-deploy LDAP smoke tests (canonical redirect, tampered query rewrite, final `200` response) and actionable failure hints.\n5.  Added/merged troubleshooting guidance for LDAP login failures, disconnects, and redirect loops into the VM troubleshooting documentation.\n6.  Improved Projects table readability in the Shiny UI (`sequencing-app/app.R`):\n    - explicit DT column widths\n    - wrapped long cell text\n    - reliable column reflow on tab switch and resize\n    - preserved horizontal scrolling and existing formatting.\n\n## Changes on 11.02.2026\n\n1.  Added a production rollout checklist with the exact commands for pull, backup, deploy, restart, and smoke‑tests.\n2.  Added a dedicated section for **admin access in LDAP mode** (pre‑create vs promote after first login).\n3.  Added a dedicated section on **switching between LDAP and local auth** on the VM (`AUTH_MODE` via systemd override).\n4.  Added the full **pre‑create admin** example that includes `password`/`email` for NOT NULL constraints.\n5.  Updated the canonical server path to `/srv/shiny-server` and corrected repo path on the local machine.\n6.  Moved legacy/obsolete content to the end of the document under **Obsolete / now wrong**.\n7.  Replaced the old deploy script reference (`deploy_shiny_server.sh`) with `deploy.sh`.\n\n## Changes on 09.02.2026\n\n1.  Added a VM rollout HOW‑TO (GitHub SSH/deploy keys, divergent branches, DB tracking fix, backups, deploy, restart, rollback).\n2.  Documented production safeguards (app folder backup, DB backup, Apache config backup).\n3.  Updated `deploy.sh` to restart Shiny only if `rsync` succeeds (prevents restarts on failed deploys).\n4.  Cleaned up Apache LDAP logging (default to quiet logs; debug only when explicitly enabled).\n5.  Made LDAP debug output in the Shiny app conditional on **both** `APP_ENV=dev` and `LDAP_DEBUG=1` to avoid production log noise.\n6.  Documented the VM LDAP validation test (real user + service group user, and email routing behavior).\n\n### VM rollout validation (what I tested and confirmed)\n\nI verified end‑to‑end behavior on the VM after fixing the Apache proxy path:\n\n-   **LDAP login works**: the browser prompts for username/password and redirects to `/sequencing-app/?auth_user=<user>`.\n-   **User mapping works**: `yeroslaviz` (OU contains Cox) is mapped to the **Cox** group and the correct PI.\n-   **User mapping works**: `yeroslaviz-test` (OU = **NGS Facility**) is treated as a service‑group user (no PI match).\n-   **Email routing works**: research group users trigger mail to the PI **and** NGS.\n-   **Email routing works**: service group users (no PI match) trigger mail to the **administrator**.\n\nIf all three happen, the LDAP→app→email flow is working as intended.\n\n## Possible errors and fixes (VM LDAP rollout)\n\nThis section captures the real errors I hit during the VM rollout and the fixes that worked. It is meant as a troubleshooting reference.\n\n### 1) Apache won’t restart after LDAP change\n\n**Symptom**\n\n```\nAH00526: Syntax error ... Bad LDAP URL while parsing.\n```\n\n**Cause**\n\nApache’s `AuthLDAPURL` is very strict. Each URL must be complete (host + base DN + query), and some Apache builds don’t accept multiple URLs in a single directive.\n\n**Fix**\n\nUse a single server (most stable on my VM):\n\n```\nAuthLDAPURL \"ldaps://ldapserv1.biochem.mpg.de:636/dc=biochem,dc=mpg,dc=de?uid?sub?(objectClass=posixAccount)\"\n```\n\nIf the multi‑server line fails, I keep one server and fall back manually if needed.\n\n### 2) `LDAPTLS_CACERTDIR` breaks Apache\n\n**Symptom**\n\n```\nInvalid command 'LDAPTLS_CACERTDIR'\n```\n\n**Cause**\n\n`LDAPTLS_CACERTDIR` is **not** an Apache directive. It belongs to the OpenLDAP client config.\n\n**Fix**\n\nRemove it from Apache. If I need TLS trust, I configure it in `/etc/ldap/ldap.conf` instead.\n\n### 3) LDAP login shows 500 Internal Server Error\n\n**Symptom**\n\n- Browser shows `Internal Server Error`\n- Apache log shows:\n\n```\nldap_simple_bind() failed][Can't contact LDAP server]\n```\n\n**Cause**\n\nLDAP TLS handshake fails (certificate trust not configured).\n\n**Fix**\n\n1. Confirm port reachability:\n\n```\nnc -vz ldapserv1.biochem.mpg.de 636\n```\n\n2. Test LDAP with **TLS bypass** to confirm trust problem:\n\n```\nLDAPTLS_REQCERT=never ldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de:636 \\\n  -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=USER)\" mail\n```\n\n3. Fix trust in `/etc/ldap/ldap.conf`:\n\n```\nTLS_CACERTDIR /etc/ssl/certs\n```\n\n**Important:** I had a typo (`TLS_CACERETDIR`) which prevented TLS trust from loading. Fixing the spelling made LDAP work.\n\n4. Verify normal LDAP now works:\n\n```\nldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de:636 \\\n  -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=USER)\" mail\n```\n\nThen restart Apache:\n\n```\nsudo systemctl restart apache2\n```\n\n### 4) Shiny app runs locally but crashes via Apache\n\n**Symptom**\n\n- App works with `shiny::runApp()`\n- But Apache shows 500 and Shiny worker terminates\n\n**Cause**\n\nLDAP authentication failure in Apache (not an app crash).\n\n**Fix**\n\nCheck Apache log for `authnz_ldap` errors and fix TLS trust as above.\n\n### 5) LDAP works, but `/sequencing-app/` returns 404\n\n**Symptom**\n\n- `curl -Ik -u USER https://host/sequencing-app/` returns **404**\n- `curl -I http://localhost:3838/sequencing-app/` returns **200**\n\n**Cause**\n\nApache is proxying the wrong path (often due to an older `ProxyPass /` rule or a backup file in `sites-enabled`).\n\n**Fix**\n\n1.  Ensure **only** these lines exist in the active config:\n\n```\nProxyPass /sequencing-app/ http://localhost:3838/sequencing-app/\nProxyPassReverse /sequencing-app/ http://localhost:3838/sequencing-app/\n```\n\n2.  Remove or move any backup config files out of `/etc/apache2/sites-enabled` (Apache can accidentally parse them).\n3.  Restart Apache:\n\n```\nsudo apache2ctl -t\nsudo systemctl restart apache2\n```\n\n### 6) Debug logging too noisy (Apache or Shiny)\n\n**Symptom**\n\nLots of LDAP debug output in logs during normal use.\n\n**Fix (Apache)**\n\nIn `01-main.conf`, use normal logging:\n\n```\nLogLevel warn\n# LogLevel authnz_ldap:debug ldap:debug   # enable only when debugging\n```\n\n**Fix (Shiny app)**\n\nThe app only prints LDAP debug logs when **both** are set:\n\n- `APP_ENV=dev`\n- `LDAP_DEBUG=1`\n\nSo for production:\n\n- Remove `LDAP_DEBUG=1` from `/home/shiny/.Renviron` (or set it to `0`).\n- Restart Shiny:\n\n```\nsudo systemctl restart shiny-server\n```\n\nIf I need debugging later, I can temporarily set:\n\n```\nAPP_ENV=dev\nLDAP_DEBUG=1\n```\n\nand restart the service again.\n\n### Comprehensive error‑checking checklist (VM LDAP + Shiny)\n\nWhen something breaks, I run through this list in order:\n\n1.  **Apache syntax**\n\n```\nsudo apache2ctl -t\n```\n\n2.  **Which vhost is active**\n\n```\nsudo apache2ctl -S\n```\n\n3.  **Proxy path**\n\n```\nsudo grep -n \"ProxyPass\" -R /etc/apache2/sites-enabled /etc/apache2/conf-enabled\n```\n\n4.  **LDAP connectivity + TLS**\n\n```\nnc -vz ldapserv1.biochem.mpg.de 636\nldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de:636 \\\n  -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=USER)\" mail\n```\n\nIf that fails, verify `/etc/ldap/ldap.conf` has:\n\n```\nTLS_CACERTDIR /etc/ssl/certs\n```\n\n5.  **LDAP auth prompt vs app redirect**\n\n```\ncurl -Ik https://HOST/\ncurl -Ik -u USER https://HOST/\n```\n\nExpected:\n401 without user, 302 to `/sequencing-app/?auth_user=USER` with user.\n\n6.  **Shiny backend is reachable**\n\n```\ncurl -I http://localhost:3838/sequencing-app/\n```\n\n7.  **Apache app path**\n\n```\ncurl -Ik -u USER https://HOST/sequencing-app/\n```\n\n8.  **Shiny logs**\n\n```\nsudo ls -t /var/log/shiny-server/ | head -n 1\nsudo tail -n 200 /var/log/shiny-server/FILE.log\n```\n\n9.  **Shiny environment variables**\n\n```\nsudo systemctl show shiny-server --property=Environment\n```\n\n10. **Database permissions**\n\n```\nls -l /srv/shiny-server/sequencing-app/sequencing_projects.db\n```\n\n11. **Reload after config change**\n\n```\nsudo systemctl restart apache2\nsudo systemctl restart shiny-server\n```\n\n## Changes on 06.02.2026\n\n1.  Added LDAP login flow in the Shiny app (auto‑login via `X-Remote-User`, local dev simulation, and optional attribute lookup).\n2.  LDAP attribute lookup now works with anonymous bind; uses `ldapsearch` fallback for older `ldapr` versions.\n3.  Added dev tools toggle (dev only) to switch between LDAP and local auth while testing.\n4.  Mapped LDAP `ou` values to budget holders, auto‑selecting the correct PI in the project form (with partial match fallback).\n5.  Added budget holder notices for multiple cost centers and missing cost center values.\n6.  Added “Other / not listed” budget holder option so users can enter a new PI (name/surname required; cost center optional with a warning).\n7.  Updated `deploy.sh` to use `rsync` and exclude `sequencing_projects.db`.\n8.  Updated Apache LDAP configuration template and added local dev testing instructions + env var cleanup.\n9.  I do **not** track SQLite DB files in git because they change constantly, are environment‑specific (local vs VM), and can contain sensitive data. I ignore `*.db`/`*.sqlite` and keep only the schema/seed files in git.\n\n## Changes on 14.11.2026\n\n1.  I would Like you to show me where the admin email address can be changed, if I want to have a different user as admin. 1.1 Please show me the parts of the script where this can be changed.\n\nThe admin password is set here:\n\n```{bash}\n# Insert default admin user\ndefault_password <- digest::digest(\"admin123\")\ndbExecute(con, \"\n  INSERT OR IGNORE INTO users (username, password, email, is_admin)\n  VALUES ('admin', ?, 'yeroslaviz@biochem.mpg.de', 1)\n\", params = list(default_password))\n```\n\n1.2 Can this be changed without recreating the whole databank or restart the app? 1.3 How do I change the admin email address without recreating the db?\n\nThis can be changed without recreating the database, using two options:\n\n-   Option 1: Direct database update\n\nRun this SQL command on your database:\n\n```{sql}\n\nUPDATE users SET email = 'newadmin@institute.org' WHERE username = 'admin';\n\n```\n\nTo execute this, we can either log in directly to the database via the command line\n\n```{bash}\nsqlite3 sequencing_projects.db\n```\n\nand execute\n\n```{bash}\nUPDATE users SET email = 'newadmin@institute.org' WHERE username = 'admin';\n.exit\n```\n\nor via the R pormpt:\n\n```{r}\nlibrary(DBI)\nlibrary(RSQLite)\ncon <- dbConnect(RSQLite::SQLite(), \"sequencing_projects.db\")\ndbExecute(con, \"UPDATE users SET email = 'newadmin@institute.org' WHERE username = 'admin'\")\ndbDisconnect(con)\n```\n\n**Don't forget to modify the `setup_database_*.R` script afterwards, so these information will be also kept, if the database is recreated!**\n\n-   Option 2: Through the app's user management (as admin)\n\nIn the \"Administer Projects\" tab, one can click \"Manage Users\" and change (or add) the admin user and edit their email.\n\n1.4 How can I turn on/off sending the notification mail to the admin, if not needed?\n\nThe admin notification email is sent in the `send_project_creation_email` function in the app file.\n\n2.  When creating a new project, an email is being sent. 2.1 can you please tell me to whome this email is being sent? 2.2 Can you show me the part of the script where it is set up? 2.3 Now, the Email should be sent to budget holder and to user, who created the project, as well as to the admin. Can this be changed easily, if needed?\n\nThis was done also in point 1. The function `send_project_creation_email` set the users who gets an email, when a project is created. the row\n\n```\n        to = c(budget_holder$email, user_email, admin_emails),\n```\n\nset the recipient of the mail. we can remove one of the elements, or even just add a specific mail address to the `to =` row.\n\n3.  How do I make changes to the cost estimations w.o. Recreating the db? 3.1 Is it possible to modify existing columns, in case prices are changing? Or would deleting and making a new element would be easier? 3.2 If I change anything in these tables, Would it also change it in the SQL data base?\n\nAt the moment the tables `Service types` and `Sequencing depths` are not editable. If prices change, the easiet option is to delete the row and recreate it using the new value. This way, the older projects will use the previous costs, while the new one will get the new costs.\n\nOne can also directly use the SQL commands to apply these chages, similar to above\n\n```{bash}\nsqlite3 sequencing_projects.db\n```\n\nand execute\n\n```{bash}\nUPDATE service_types SET costs_per_sample = 55 WHERE service_type = 'single cell/low mRNAseq';\n.exit\n```\n\n4.  something is wrong with the Sequencing Cycles Management table. When I run the app, go to the Admin projects Tab and click the Sequencing Cycles - Manage Cycles, I see this message: \"Error: An error has occurred. Check your logs or contact the app author for clarification.\" 4.1 which log files can I consult?\n\nWhen working on the server, the best place to look for problems are the log files of either the `apache2` (`/var/log/apache2/`) or the `shiny-server` (`/var/log/shiny-server/`).\n\n5.  Do I have a weekly backup of the SQL db? \n\nthere is an app for a bi-weekly automaic backup. The function is for now commented out, so not working.\n\n### modify registration page\n\n```{bash}\nsqlite3 sequencing_projects.db\n```\n\nwe add information to the registration page, so the user must choose a group. This way we know which is the budget holder for this user.\n\nAfter ward we added the information to the Registration Server Logic\n\n```{bash}\ndbExecute(con, \"\nINSERT INTO users (username, password, email, phone, research_group, is_admin)\nVALUES (?, ?, ?, ?, ?, 0)\n\", params = list(\n  input$reg_username,\n  digest(input$reg_password),\n  input$reg_email,\n  input$reg_phone,\n  input$reg_group\n))\n```\n\nas well as modified the User registration modal\n\nNow, when a user register, he must choose a group from the given drop-down menu. this group is attached to the budget holder. When the user creates a new project, this budget holder (group) will automatically be assigned to the project (This can be manually changed, when the project is created).\n\nI have changed the `setup_databases.R` script to load the budget holders information from a csv file, stored in the same folder as the script itself.\n\nWe have a csv-formatted table with the information of the groups and their cost centers. This is an easy way to upload the information.\n\n```\nname,surname,email,cost_center\nKim,Rin-Ho,rkim@biochem.mpg.de,N.A.\nAdministrator,surname,rkim@biochem.mpg.de,N.A.\nBaier,Herwig,herwig.baier@bi.mpg.de,P350\nBaldwin,Maude,Maude.Baldwin@bi.mpg.de,P550\n```\n\nThe registration process was change to make choosing a research group mandatory. The chosen research group is then set to also assign the cost center to the user.\n\n::: callout-note\nSome of the research groups have multiple cost centers.\n\nWhen a user registers, he must select a research group. The user then gets assigned a cost center based on the table of budget holders. If (and this applies only for some of the budget holders), this specific research group has multiple cost centers, it gets assigned the first one found by the app. BUT, manually the user still can change this in the app when applying for a project.\n:::\n\n### control for budegt holder info in the DB\n\n```{r}\n#| eval: false\ncon <- dbConnect(RSQLite::SQLite(), \"sequencing_projects.db\")\nbudget_holders <- dbGetQuery(con, \"SELECT * FROM budget_holders\")\n# Print the data\nprint(budget_holders[1:3,])\ndbGetQuery(con, \"SELECT * FROM budget_holders\")\ndbGetQuery(con, \"SELECT * FROM users\")\non.exit(dbDisconnect(con))\n```\n\n### Budget holders can be read from an Excel sheet\n\n## SSL Certificate (for HTTPS)\n\nthe new setting of the certificates. I have three files.\n\nThe private key I created when applying for the certificate. The other two were downloaded, when the emial came from Harica (the certificate provider).\n\nthe `PEM` is the pem file and the `DER (issuer)` is the chain file. Both of them are needed.\n\nSetting for the readability of the files:\n\n```\ncd /etc/apache2/certificate/2026\n-rw------- 1 yeroslaviz b_mcf 3272 Nov 10 15:58 private-key.pem # udo chmod 600 /path/to/private.key  # Readable only by root\n-rw-r--r-- 1 yeroslaviz b_mcf 1545 Nov 14 12:12 NGS_2026_Issuer_ChainFile.cer # sudo chmod 644 /path/to/chain.crt  # Readable by all\n-rw-r--r-- 1 yeroslaviz b_mcf 2796 Nov 14 12:34 NGS_2026_Cert.pem # sudo chmod 644 /path/to/certificate.crt # Readable by all\n```\n\nAll the files are saved under `/etc/apache2/certificate/2026`.\n\nNow I created soft links for each of these files.\n\n```{bash}\nsudo ln -s /etc/apache2/certificate/2026/private-key.pem /etc/ssl/private/2026_private-key.pem\nsudo ln -s /etc/apache2/certificate/2026/NGS_2026_Cert.pem /etc/ssl/certs/2026_NGS_Cert.pem\n\n```\n\n## LDAP\n\nThe app uses Apache LDAP authentication in front of Shiny. The Apache config template is in `01-main.conf`.\n\nEnable required Apache modules:\n\n```{bash}\nsudo a2enmod ldap authnz_ldap headers\nsudo systemctl reload apache2\n```\n\nTest whether anonymous LDAP search works:\n\n```{bash}\nldapsearch -x -H ldaps://ldapserv1.biochem.mpg.de -b \"dc=biochem,dc=mpg,dc=de\" \"(uid=YOURUSER)\"\n```\n\nIf anonymous search fails, use bind credentials from IT and add them to the Apache config:\n\n``` apache\nAuthLDAPBindDN \"cn=binduser,dc=biochem,dc=mpg,dc=de\"\nAuthLDAPBindPassword \"REDACTED\"\n```\n\n::: callout-warning\nFor production, **do not use a personal account** for LDAP binding. Ask IT for a dedicated **service bind account** with read‑only permissions and store those credentials securely.\n:::\n\nSet app environment variables for Shiny Server (systemd override recommended):\n\n```{bash}\nsudo systemctl edit shiny-server\n```\n\n``` ini\n[Service]\nEnvironment=AUTH_MODE=ldap\nEnvironment=LDAP_URI=ldaps://ldapserv1.biochem.mpg.de:636,ldaps://ldapserv2.biochem.mpg.de:636,ldaps://ldapserv3.biochem.mpg.de:636\nEnvironment=LDAP_BASE_DN=dc=biochem,dc=mpg,dc=de\n# If you want to restrict search to the user OU:\n# Environment=LDAP_BASE_DN=ou=People,dc=biochem,dc=mpg,dc=de\n# Optional bind credentials (only if anonymous LDAP search is blocked):\n# Environment=LDAP_BIND_DN=cn=binduser,dc=biochem,dc=mpg,dc=de\n# Environment=LDAP_BIND_PW=REDACTED\n```\n\nRestart services after config changes:\n\n```{bash}\nsudo systemctl restart apache2\nsudo systemctl restart shiny-server\n```\n\n### Admin access in LDAP mode (VM)\n\nWhen `AUTH_MODE=ldap` is enabled, the local login form is disabled. To get admin access, I mark the **LDAP user** as admin in the SQLite database.\n\n**Option 1: Pre‑create the user as admin (works even before first login)**\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"INSERT OR IGNORE INTO users (username, is_admin) VALUES ('soyer', 1);\"\n```\n\nIf the insert is ignored because the table requires `password`/`email`, use:\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"INSERT OR IGNORE INTO users (username, password, email, is_admin) VALUES ('soyer', 'ldap-only', 'soyer@biochem.mpg.de', 1);\"\n```\n\nOn first LDAP login, the app fills in email/phone/OU (if missing).\n\n**Option 2: Promote after the user logs in once**\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"UPDATE users SET is_admin=1 WHERE username='soyer';\"\n```\n\nNote: `UPDATE` does nothing if the user row does **not** exist yet.\n\n**Verify:**\n\n```{bash}\nsudo -u shiny sqlite3 /srv/shiny-server/sequencing-app/sequencing_projects.db \\\n\"SELECT username, is_admin FROM users WHERE username IN ('yeroslaviz','soyer');\"\n```\n\n### Switch between LDAP and local modes (VM)\n\nI switch auth modes by changing the `AUTH_MODE` environment variable for the `shiny-server` service and restarting it.\n\nOpen the systemd override:\n\n```{bash}\nsudo systemctl edit shiny-server\n```\n\n**LDAP mode (production):**\n\n```ini\n[Service]\nEnvironment=AUTH_MODE=ldap\nEnvironment=LDAP_URI=ldaps://ldapserv1.biochem.mpg.de:636,ldaps://ldapserv2.biochem.mpg.de:636,ldaps://ldapserv3.biochem.mpg.de:636\nEnvironment=LDAP_BASE_DN=dc=biochem,dc=mpg,dc=de\n```\n\n**Local mode (maintenance/testing):**\n\n```ini\n[Service]\nEnvironment=AUTH_MODE=local\n```\n\nApply changes:\n\n```{bash}\nsudo systemctl restart shiny-server\nsudo systemctl show shiny-server --property=Environment\n```\n\nIf I switch back to LDAP, I also remove any dev‑only variables like `DEV_REMOTE_USER`.\n\n### Local dev testing (LDAP mode)\n\nTo test LDAP integration on your local machine without affecting production, run the app in dev mode and simulate the authenticated user. If LDAP attribute lookup is needed, provide a bind DN/password (personal credentials are OK for **local testing only**).\n\n``` r\nSys.setenv(\n  APP_ENV = \"dev\",\n  AUTH_MODE = \"ldap\",\n  DEV_REMOTE_USER = \"your_username\",\n  LDAP_BIND_DN = \"uid=your_username,ou=YourGroup,ou=Research Group,ou=People,dc=biochem,dc=mpg,dc=de\",\n  LDAP_BIND_PW = \"YOUR_PASSWORD\"\n)\nshiny::runApp(\"sequencing-app\")\n```\n\nAfter login, verify the user record in SQLite:\n\n``` r\ncon <- DBI::dbConnect(RSQLite::SQLite(), \"sequencing-app/sequencing_projects.db\")\nDBI::dbGetQuery(con, \"SELECT username, email, phone, research_group FROM users WHERE username='your_username'\")\nDBI::dbDisconnect(con)\n```\n\nTo switch back to normal local login (no LDAP), run:\n\n``` r\nSys.setenv(APP_ENV = \"dev\", AUTH_MODE = \"local\")\nshiny::runApp(\"sequencing-app\")\n```\n\nTo fully clear the LDAP/testing variables in your R session:\n\n``` r\nSys.unsetenv(c(\n  \"APP_ENV\", \"AUTH_MODE\", \"DEV_REMOTE_USER\",\n  \"LDAP_BIND_DN\", \"LDAP_BIND_PW\",\n  \"LDAP_URI\", \"LDAP_BASE_DN\", \"LDAP_DEBUG\"\n))\n```\n\n### How I run the app locally (my notes)\n\nWhen I want the **normal local login**, I run:\n\n```r\nSys.setenv(APP_ENV = \"dev\", AUTH_MODE = \"local\")\nshiny::runApp(\"sequencing-app\")\n```\n\nWhen I want to **simulate production LDAP login**, I run:\n\n```r\nSys.setenv(\n  APP_ENV = \"dev\",\n  AUTH_MODE = \"ldap\",\n  DEV_REMOTE_USER = \"my_username\",\n  LDAP_URI = \"ldaps://ldapserv1.biochem.mpg.de:636,ldaps://ldapserv2.biochem.mpg.de:636,ldaps://ldapserv3.biochem.mpg.de:636\",\n  LDAP_BASE_DN = \"dc=biochem,dc=mpg,dc=de\"\n)\nshiny::runApp(\"sequencing-app\")\n```\n\nIf I want to fully reset the session, I clear the env vars:\n\n```r\nSys.unsetenv(c(\n  \"APP_ENV\", \"AUTH_MODE\", \"DEV_REMOTE_USER\",\n  \"LDAP_BIND_DN\", \"LDAP_BIND_PW\",\n  \"LDAP_URI\", \"LDAP_BASE_DN\", \"LDAP_DEBUG\"\n))\n```\n\n**Local vs LDAP mode (practical difference for me):**\n\n- Local mode uses the SQLite users/passwords and shows the normal login screen.\n- LDAP mode auto‑logs in with the LDAP user, pulls email/phone/OU, and hides the local login UI.\n- LDAP mode needs network access to the institute LDAP servers.\n\n**Dev badge:**\nIn dev mode, I see a small badge in the app header that shows `DEV · LDAP` or `DEV · LOCAL`, so I always know which mode I’m running.\n\n### Budget holder auto-assignment (first login)\n\nOn first LDAP login, the app attempts to map the user to a budget holder based on the LDAP `ou` value.\\\nIf the `ou` contains a group key in parentheses (e.g., `(... Cox)`), the app matches that key against `budget_holders` and stores the **full PI name** (e.g., `Cox Juergen`) in `users.research_group`.\n\nWhen a new project is created, this `research_group` value is used to auto‑select the budget holder (and thus the cost center).\\\nIf multiple cost centers exist for the same PI, the first match is selected by default and can be adjusted during project creation.\n\n## Obsolete / now wrong (kept for reference)\n\nThese sections are retained to understand the history but should not be followed anymore.\n\n### Legacy environment variable location (no longer used)\n\n```{bash}\n\n# /var/shiny-server/.Renviron\nTZ=Europe/Berlin\nLANG=en_US.UTF-8\nLC_ALL=en_US.UTF-8\n\n```\n\n### Legacy folder layout (/var/shiny-server)\n\n```\n/var/shiny-server/\n├── sequencing-app/\n│ ├── app.R\n│ ├── setup_database.R\n│ ├── sequencing_projects.db\n│ └── www/\n  │ ├── logo.png\n  │ └── minerva.png\n```\n\n### Legacy install steps (nginx-based, superseded by Apache setup)\n\n```{bash}\n\n# Install Shiny Server on Ubuntu\nsudo apt update\nsudo apt install -y r-base nginx\nsudo apt install -y libfontconfig1-dev libfreetype6-dev libpng-dev libtiff5-dev \\\n    libjpeg-dev build-essential pkg-config libharfbuzz-dev libfribidi-dev\nsudo apt install -y libldap2-dev libsasl2-dev\n\nsudo su - -c \"R -e \\\"install.packages('shiny')\\\"\"\nsudo su - -c \"R -e \\\"install.packages('shinyjs')\\\"\"\n# ... install all your R packages\nsudo R -e \"install.packages(c('shiny', 'shinyjs', 'DBI', 'RSQLite', 'digest', 'DT', 'shinyWidgets', 'mailR'))\"\n# these two packages were added later on for the connection of the app to the LDAP server\nsudo R -e \"install.packages(c('devtools'))\"\nsudo R -e \"devtools::install_github('liamgilbey/ldapr')\"\n\n# Download and install Shiny Server\nwget https://download3.rstudio.org/ubuntu-20.04/x86_64/shiny-server-1.5.23.1030-amd64.deb\nsudo gdebi shiny-server-1.5.23.1030-amd64.deb\n\n```\n\n### Legacy Apache config (old ProxyPass / path)\n\n```{bash}\n<VirtualHost *:80>\n    ServerName ngs-testing-vm\n    ServerAlias ngs-testing-vm.biochem.mpg.de\n    # Redirect all HTTP traffic to HTTPS\n    Redirect permanent / https://ngs-testing-vm/\n</VirtualHost>\n\n<VirtualHost *:443>\n    ServerName ngs-testing-vm\n    ServerAlias ngs-testing-vm.biochem.mpg.de\n\n    # SSL Configuration\n    SSLEngine on\n    SSLCertificateFile /etc/ssl/certs/2026_NGS_Cert.pem\n    SSLCertificateKeyFile /etc/ssl/private/2026_private-key.pem\n    SSLCertificateChainFile /etc/apache2/certificate/2026/NGS_2026_Issuer_ChainFile.cer\n\n    # Modern SSL configuration\n    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1\n    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384\n    SSLHonorCipherOrder off\n\n    # Reverse proxy for Shiny app\n    ProxyPreserveHost On\n    ProxyRequests Off\n    ProxyPass / http://localhost:3838/sequencing-app/\n    ProxyPassReverse / http://localhost:3838/sequencing-app/\n\n    # WebSocket support\n    RewriteEngine on\n    RewriteCond %{HTTP:Upgrade} websocket [NC]\n    RewriteCond %{HTTP:Connection} upgrade [NC]\n    RewriteRule ^/(.*) \"ws://localhost:3838/sequencing-app/$1\" [P,L]\n\n    # Security headers\n    Header always set Strict-Transport-Security \"max-age=63072000; includeSubDomains\"\n    Header always set X-Content-Type-Options nosniff\n    Header always set X-Frame-Options SAMEORIGIN\n    Header always set Referrer-Policy \"strict-origin-when-cross-origin\"\n\n    ErrorLog ${APACHE_LOG_DIR}/sequencing-app-ssl-error.log\n    CustomLog ${APACHE_LOG_DIR}/sequencing-app-ssl-access.log combined\n</VirtualHost>\n```\n\n### Legacy deployment script name\n\nThe old notes referenced `deploy_shiny_server.sh`. This has been replaced by `deploy.sh` in the repo root.\n\n### Legacy tree output (old VM layout example)\n\n```\n$ tree -L 1\n.\n├── BCFNGS-project-management\n├── chemata\n├── miniconda3\n└── scripts\n    └── deploy_shiny_server.sh\n```\n\n### Legacy git pull via HTTPS + PAT (no longer used)\n\n```{bash}\n git pull origin main\n# Username for 'https://github.com': yeroslaviz\n# Password for 'https://yeroslaviz@github.com':  HERE WE MUST INPUT THE PAT from above!!!\n ...\n```\n\n### Legacy note: dedicated user (superseded)\n\nAs we're planning to use the LDAP, I'm not sure, this is necessary. I need a method to add specific users as admin.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":false,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":true,"output-file":"server-preparations.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.27","title":"Server Preparations"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}